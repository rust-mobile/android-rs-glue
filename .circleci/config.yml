version: 2

jobs:

  test:
    working_directory: ~/android-rs-glue
    docker:
      - image: mackeyja92/rustup
    steps:
      - run:
          name: Install dependencies
          command: |
            apt-get update
            apt-get install -yq sudo curl wget git file g++ cmake pkg-config bison flex unzip ant openjdk-8-jdk lib32stdc++6 lib32z1
            rustup default nightly
      - checkout
      - run: cargo build --verbose --manifest-path glue/Cargo.toml
      - run: cargo build --verbose --manifest-path cargo-apk/Cargo.toml
      - run: docker build -t cargo-apk .
      - run: docker run --rm -v `pwd`:/root/src -w /root/src/examples/basic cargo-apk cargo apk
      - run: docker run --rm -v `pwd`:/root/src -w /root/src/examples/use_assets cargo-apk cargo apk
      - run: docker run --rm -v `pwd`:/root/src -w /root/src/examples/use_icon cargo-apk cargo apk

workflows:
  version: 2
  build-test-and-deploy:
    jobs:
      - test
